(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{218:function(e,t,n){e.exports=n(347)},244:function(e,t){},257:function(e,t){},259:function(e,t){},347:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),a=n(106),i=n.n(a),c=n(59),s=n(43),l=n(22),u=n(23),m=n(25),d=n(24),p=n(26),g=n(107),f=n.n(g),v=n(108),h=n.n(v),b="http://localhost:3000/",O=!0,j=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(m.a)(this,Object(d.a)(t).call(this,e))).getMedia=function(e,t){var n={video:!0,audio:!0};return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(n).then(function(t){return e(t)}).catch(function(e){return t(e)}):navigator.getUserMedia(n,e,t)},n.onMedia=function(e){var t=n.props,r=t.setStream,o=t.destroyPeer;r(e),n.stream=e,n.socket=f()(b),n.socket.on("peer",function(t){var r=t.peerId;if(console.log("new peer poof!",r),r===n.socket.id)return console.log("Peer is me :D",r);n.createPeer(r,!0,e)}),n.socket.on("signal",function(t){var r=t.from,o=n.props,a=o.peers,i=o.signalPeer;a[r]||n.createPeer(r,!1,e),console.log("Setting signal",r,t),i(r,t.signal)}),n.socket.on("unpeer",function(e){console.log("Unpeer",e),o(e.peerId)})},n.createPeer=function(e,t,r){var o=new h.a({initiator:t,trickle:O,stream:r});return o.on("signal",function(t){var r={msgId:(new Date).getTime(),signal:t,to:e};console.log("Peer signal:",r),n.socket.emit("signal",r)}),o.on("stream",function(t){var r=n.props.setPeerState;console.log("Got peer stream!!!",e,t),o.stream=t,r(e,o)}),o.on("connect",function(){console.log("Connected to peer",e),o.connected=!0,(0,n.props.setPeerState)(e,o),o.send(n.serialize({msg:"hey man!"}))}),o.on("data",function(t){console.log("Data from peer",e,n.unserialize(t))}),o.on("error",function(t){console.log("Peer error %s:",e,t)}),(0,n.props.setPeerState)(e,o),o},n.serialize=function(e){return JSON.stringify(e)},n.unserialize=function(e){try{return JSON.parse(e.toString())}catch(t){return}},n.getMedia(n.onMedia,function(e){return console.log(e)}),n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return null}}]),t}(r.Component),S=n(7),P=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(m.a)(this,Object(d.a)(t).call(this,e))).renderPeers=function(){var e,t=n.props.peers,r=Object.keys(t).length;return e=12/r<4?4:12/r,console.log("Size:",e),Object.entries(t).map(function(t){console.log(t);var n=Object(s.a)(t,2),r=n[0],a=n[1];return console.log("render peer",r,a,t),console.log("Peer",a),o.a.createElement(S.b,{item:!0,xs:e,key:r},o.a.createElement("video",{ref:function(e){return a.video=e}}))})},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){var e=this.props.localStream;e&&this.video&&!this.video.srcObject&&(this.video.srcObject=e)}},{key:"render",value:function(){var e=this;return o.a.createElement(S.c,null,o.a.createElement(S.b,{container:!0},o.a.createElement(S.b,{item:!0,xs:12},o.a.createElement("video",{id:"localStream",ref:function(t){return e.video=t},controls:!0})),this.renderPeers()))}}]),t}(r.Component),y=n(56),k=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(m.a)(this,Object(d.a)(t).call(this))).attachPeerVideos=function(){var t=e.state.peers;Object.entries(t).forEach(function(e){var t=Object(s.a)(e,2),n=t[0],r=t[1];r.video&&!r.video.srcObject&&r.stream&&(console.log("setting peer video stream",n,r.stream),r.video.setAttribute("data-peer-id",n),r.video.srcObject=r.stream,r.video.play())})},e.signalPeer=function(t,n){try{var r=e.state.peers[t];console.log("Signal peer",r),r.signal(n)}catch(o){console.log("sigal error",o)}},e.destroyPeer=function(t){var n=Object(c.a)({},e.state.peers);delete n[t],e.setState({peers:n})},e.setPeerState=function(t,n){console.log("SetPeerState"),console.log(t,n);var r=Object(c.a)({},e.state.peers);r[t]=n,e.setState({peers:r})},e.setStream=function(t){e.setState({localStream:t}),e.forceUpdate()},e.state={peers:{},localStream:null},e}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){this.attachPeerVideos()}},{key:"render",value:function(){var e=this.state,t=e.peers,n=e.localStream,r=this.props.classes;return o.a.createElement(o.a.Fragment,null,o.a.createElement(S.b,{container:!0},o.a.createElement(S.b,{item:!0,xs:12},o.a.createElement(S.a,null,o.a.createElement(S.d,null,o.a.createElement(S.e,null,"Video conference")))),o.a.createElement(S.b,{item:!0,xs:12,className:r.root},o.a.createElement(P,{peers:t,localStream:n}))),o.a.createElement(j,{setPeerState:this.setPeerState,setStream:this.setStream,destroyPeer:this.destroyPeer,signalPeer:this.signalPeer,peers:t}))}}]),t}(r.Component),E=Object(y.a)({root:{maxWidth:"1500px !important",margin:"20px 0 20px 0 !important",display:"flex",alignItems:"center"}})(k);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(E,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[218,1,2]]]);
//# sourceMappingURL=main.d494902a.chunk.js.map